# 操作系统内核
现代操作系统内核常见的两种就是 Linux内核 和 Windows内核。Linux内核设计采用的是宏内核，Windows才用的是混合内核（宏+微）
**什么是内核？**
首先，计算机是由各种外部硬件设备组成的，比如cpu、内存条、硬盘等等，既然有了这些硬件支持，还需要一个东西来把它们和应用串联起来，这个时候，内核就出来了，它可以作为应用连接硬件设备的桥梁，有了内核，应用程序就只需要关心与内核的交互，而不用关心硬件的细节了。用《深入理解linux内核》中的一句话解释就是：内核本身不是一个进程，而是进程的管理者。
**内核的功能？**
一般有4个功能：
首先是进程调度功能，内核可以管理进程、线程，决定哪个进程、线程使用CPU；
其次是内存管理功能，内核可以管理内存，决定内存的分配和回收；
然后是硬件通信功能，内核可以管理硬件设备，为进程与硬件设备之间提供通信能力；
最后，它是用户程序与操作系统之间的接口，它提供系统调用，如果应用程序要运行更高权限才能运行的服务，就需要系统调用。
**内核是怎么工作的？**
操作系统把内存分成了两个区域：内核空间，只有内核程序可以访问；用户空间，专门给程序性使用。
用户空间的代码只能访问一个局部的内存空间，而内核空间的代码可以访问所有内存空间。如果程序要进入内核空间，就要通过系统调用。
![Alt text](https://wx4.sinaimg.cn/mw2000/008sKdQply1h2xq4zvtwdj30ja0720tw.jpg)
内核程序执行在内核态，用户程序执行在用户态。当应用程序使用系统调用时，会产生一个中断。发生中断后，CPU会中断当前在执行的用户程序，转而跳转到中断处理程序，也就是开始执行内核程序。内核处理完后，会主动触发中断，把CPU执行权限交回给用户程序，回到用户态继续工作。
***微内核和宏内核***
**宏内核：**除了最基本的进程、线程管理、内存管理外，将文件系统，驱动，网络协议等等都集成在内核里面，例如linux内核。
**优点：**效率高。
**缺点：**稳定性差，开发过程中的bug经常会导致整个系统挂掉。
**微内核：**内核中只有最基本的调度、内存管理。驱动、文件系统等都是用户态的守护进程去实现的。
**优点：**稳定，驱动等的错误只会导致相应进程死掉，不会导致整个系统都崩溃
**缺点：**效率低。典型代表QNX，QNX的文件系统是跑在用户态的进程，称为resmgr的东西，是订阅发布机制，文件系统的错误只会导致这个守护进程挂掉。不过数据吞吐量就比较不乐观了。
